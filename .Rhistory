get_clean <- function(x){
#this does not remove "+" and certain special characters
#y<- str_replace_all(x, "[[:punct:]]", "")
#remove date
#y <- gsub("[0-9]\\+", "",x)
#gsub("-", "",x)
#gsub("[.]", "",x)
# this one removes non-alphanumerics including space
#y <- gsub("(?:(-| ))-+\\s*","",x)
#y <- gsub("^-|-$", "", x)
#y <- gsub("[^[:alnum:][:space:]]","",x)
y <- gsub("^[^a-zA-Z]|[^a-zA-Z]$","",x)
#gsub("[[:alnum:]]","",x)
y <- gsub("^X$","",y)
y <- gsub("^NA$",NA,y)
return(y)
}
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("[^[:alnum:][:space:]]","",`Pekerjaan Utama`))
#remove symbol -,.,
#
tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = get_clean(`Pekerjaan Utama`))
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("-","",`Pekerjaan Utama`))
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"EX-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,".")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"\\.")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"SEP")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
get_clean <- function(x){
#this does not remove "+" and certain special characters
#y<- str_replace_all(x, "[[:punct:]]", "")
#remove date
#y <- gsub("[0-9]\\+", "",x)
#gsub("-", "",x)
#gsub("[.]", "",x)
# this one removes non-alphanumerics including space
#y <- gsub("(?:(-| ))-+\\s*","",x)
#y <- gsub("^-|-$", "", x)
#y <- gsub("[^[:alnum:][:space:]]","",x)
y <- gsub("^[^a-zA-Z0-9]|[^a-zA-Z0-9]$","",x)
#gsub("[[:alnum:]]","",x)
y <- gsub("^X$","",y)
y <- gsub("^NA$",NA,y)
return(y)
}
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("[^[:alnum:][:space:]]","",`Pekerjaan Utama`))
#remove symbol -,.,
#
tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = get_clean(`Pekerjaan Utama`))
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("-","",`Pekerjaan Utama`))
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"SEP")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"EX-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
get_clean <- function(x){
#this does not remove "+" and certain special characters
#y<- str_replace_all(x, "[[:punct:]]", "")
#remove date
#y <- gsub("[0-9]\\+", "",x)
#gsub("-", "",x)
#gsub("[.]", "",x)
# this one removes non-alphanumerics including space
#y <- gsub("(?:(-| ))-+\\s*","",x)
#y <- gsub("^-|-$", "", x)
#y <- gsub("[^[:alnum:][:space:]]","",x)
y <- gsub("^[^a-zA-Z0-9]|[^a-zA-Z0-9]$","",x)
y <- gsub("^-+$","",y)
#gsub("[[:alnum:]]","",x)
y <- gsub("^X$","",y)
y <- gsub("^NA$",NA,y)
return(y)
}
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("[^[:alnum:][:space:]]","",`Pekerjaan Utama`))
#remove symbol -,.,
#
tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = get_clean(`Pekerjaan Utama`))
#tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = gsub("-","",`Pekerjaan Utama`))
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"EX-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"EX-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
tb_index_rc %>% filter(str_detect(`Pekerjaan Utama`,"-")) %>% count(`Pekerjaan Utama`,`Clean Pekerjaan`)
#remove symbol -,.,
#
tb_index_rc <- tb_index_rc %>% mutate("Clean Pekerjaan" = get_clean(`Pekerjaan Utama`))
#recode pekerjaan
job_recode <- function(x){
#NIAGA as SELF-EMPLOYED except PHARMANIAGA
#ADMIN as employed
y <- case_when(
str_detect(x,"NIAGA") & str_detect(x,"PHARMA") ~ "EMPLOYED",
str_detect(x,"^JURU|^AKAU|BANK|OPERATOR|ADMIN|KERANI|ANGGOTA|PEGAWAI|DOKTOR|GURU|CIKGU|LECTURER|PEGUAM|PENGAJAR|PENSYARAH|ENGINEER|TECHNICIAN|JURUTERA") ~ "EMPLOYED",
str_detect(x,"POLIS|BOMBA|KESELAMATAN|ARKITEK|OFFICER|TENTERA|ASKAR|PENGUATKUASA|KESIHATAN|NURSE|WARDEN|PENGAWAL|SECURITY|GUARD|SEKURITI|DRIVER|PERTAHANAN") ~ "EMPLOYED",
str_detect(x,"KILANG|SUPERVISOR|SWASTA|TUKANG KEBUN|DESPATCH|STOR|PROMOTE|MEKANIK|FOREMAN|MECHANIC|WELD") ~ "EMPLOYED",
str_detect(x,"GENERAL|WORK|WAIT|PELAYAN|CHEF|TUKANG MASAK|CASHIER|SALESMAN|CUSTOMER SERVICE|TUKANG CUCI|TUKANG GUNTING RAMBUT|CLEANER|TUKANG SAPU") ~ "EMPLOYED",
str_detect(x,"BURUH|LABOURER|KELINDAN|PENCUCI KERETA|PENGHANTAR|RECEPTIONIS|SETIAUSAHA|CLERK|OFFICE BOY|MARKETING") ~ "EMPLOYED",
str_detect(x,"HOUSEKEEPING|HOUSE KEEPING|OFFSHORE|KERJA|ELECTRICIAN|PENYAMBUT TETAMU|HOTEL") ~ "EMPLOYED",
str_detect(x,"PEMANDU") & !str_detect(x,"TEKSI") ~ "EMPLOYED",
str_detect(x,"TUAI RUMAH|POSMEN|MAID|ORANG GAJI|GRAFIK|PROGRAMMER|WEB|SOFTWARE|WAREHOUSE|DESIGNER|AUDITOR|CONSULTANT") ~ "EMPLOYED",
str_detect(x,"KETUA|PENGETUA|PENGHULU") ~ "EMPLOYED",
str_detect(x,"ACCO") ~ "EMPLOYED",
str_detect(x,"AGENSI") ~ "EMPLOYED",
str_detect(x,"PENGURUS|PENYELIA|MANAGER|PENGARAH|MANDUR") ~ "EMPLOYED",
str_detect(x,"PEKERJA") & !str_detect(x,"AGEN")~ "EMPLOYED",
str_detect(x,"PEMBANTU|^ASS| ASS")  ~ "EMPLOYED",
str_detect(x,"EXC") | str_detect(x,"EXEC") | str_detect(x,"EKSE") ~ "EMPLOYED",
#str_detect(x,"SENDIRI") & !str_detect(x,"^SUR")~ "SELF-EMPLOYED",
str_detect(x,"^SURV") ~ "EMPLOYED",
str_detect(x,"BUSINESS|BISNES|USAHAWAN|PEMOTONG RUMPUT|PENGASUH") ~ "SELF-EMPLOYED",
str_detect(x,"PETANI|PENEROKA|NELAYAN|PENOREH|MENOREH|PESAWAH|PEKEBUN|PELADANG|KAMPUNG") ~ "SELF-EMPLOYED",
str_detect(x,"PLUMBER|TUKANG.*RUMAH|TUKANG KAYU|TUKANG CAT|TUKANG JAHIT|TAILOR|PEMOTONG KAYU|TUKANG URUT|TUKANG PAIP|TUKANG BESI|TUKANG WIRING|TUKANG KIMPAL|TUKANG KASUT|PENYANYI|CARPENTER|FARMER") ~ "SELF-EMPLOYED",
str_detect(x,"NIAGA") | str_detect(x,"JAJA") | str_detect(x,"JUAL") & !str_detect(x,"PHARMA") ~ "SELF-EMPLOYED",
str_detect(x,"^NA$|NIL") ~ "UNEMPLOYED"
#str_detect(x,"^SUR") | str_detect(x,"^SRT") & !str_detect(x,"^SURV") ~ "SRT",
#str_detect(x,"^SURV") ~ "UNEMPLOYED"
)
#KONTRAK|KONTREK|
y <- ifelse(str_detect(x,"WARGA"),ifelse(str_detect(x,"TUA|MAS") & !str_detect(x,"ASING"),"UNEMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"OLD AGE"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"KONT|CONT"),ifelse(str_detect(x,"CONTRACTOR|KONTRAK|KONTAKTOR|KONTREKTOR|KONTAK|KONTARKTOR|KONTARK|KONTRACT|KONTARAKTOR") & !str_detect(x,"BURU|KERJA|GURU|JURUTERA|JURUUKUR"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"WIR"),ifelse(str_detect(x,"ONLINE"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"PESARA") | str_detect(x,"PERSARA") | str_detect(x,"BERSARA") | str_detect(x,"BESARA") | str_detect(x,"PENCEN") | str_detect(x,"PENSION") | str_detect(x,"RETIRED"),"RETIREE",y)
y <- ifelse(str_detect(x,"SALE"),ifelse(str_detect(x,"ONLINE"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"KANAK|^BAYI$"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"^SUR|SRT|HOUSEWIFE") & !str_detect(x,"^SURV"),"SRT",y)
y <- ifelse(str_detect(x,"SEX WORKER"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"TEKSI")& !str_detect(x,"KERANI|PENYELIA"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"^AGEN|^AGEN$|AGENT|^AJEN|^EJEN"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"SENDIRI|BEBAS|FREELANCE"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"PELAJAR|STUDENT|BELAJAR"),"STUDENT",y)
y <- ifelse(str_detect(x,"TIDAK|BEKAS|^TIADA")&!str_detect(x,"BANDUAN"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"PENGANGGUR|PENGGANGUR|MENGANGGUR|PENGANGUR|KEBUN|HOMELESS|GELANDANGAN|UNEMPLOYED"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"BEKAS|^EX "),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"BANDUAN") & !str_detect(x,"BEKAS"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"RUMAH ORANG TUA"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"BANDUAN") & !str_detect(x,"BEKAS") & str_detect(x,"TIDAK"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"TAHANAN|^TAHANAN| TAHANAN|DITAHAN|TAHAN") & !str_detect(x,"PERTAHANAN|PEGAWAI|PEMANDU|POLIS|TENTERA"),ifelse(str_detect(x,"BEKAS"),"UNEMPLOYED","INSTITUTION"),y)
#y <- ifelse(str_detect(x,"^NA$"),NA,y)
#y <- ifelse(str_detect(x,"PESARA") | str_detect(x,"BERSARA") | str_detect(x,"BESARA"),"UNEMPLOYED",y)
return(y)
}
tb_index_rc <- tb_index_rc %>% mutate("Recode Pekerjaan" = job_recode(`Clean Pekerjaan`))
job_cat <- tb_index_rc %>% filter(is.na(`Recode Pekerjaan`)) %>% count(`Clean Pekerjaan`,`Recode Pekerjaan`) %>% arrange(desc(n))
View(job_cat)
View(job_cat)
write_csv(tb_index_rc,"input/clean_data/TB_index_rc.csv")
#recode pekerjaan
job_recode <- function(x){
#NIAGA as SELF-EMPLOYED except PHARMANIAGA
#ADMIN as employed
y <- case_when(
str_detect(x,"NIAGA") & str_detect(x,"PHARMA") ~ "EMPLOYED",
str_detect(x,"^JURU|^AKAU|BANK|OPERATOR|ADMIN|KERANI|ANGGOTA|PEGAWAI|DOKTOR|GURU|CIKGU|LECTURER|PEGUAM|PENGAJAR|PENSYARAH|ENGINEER|TECHNICIAN|JURUTERA") ~ "EMPLOYED",
str_detect(x,"POLIS|BOMBA|KESELAMATAN|ARKITEK|OFFICER|TENTERA|ASKAR|PENGUATKUASA|KESIHATAN|NURSE|WARDEN|PENGAWAL|SECURITY|GUARD|SEKURITI|DRIVER|PERTAHANAN") ~ "EMPLOYED",
str_detect(x,"KILANG|SUPERVISOR|SWASTA|TUKANG KEBUN|DESPATCH|STOR|PROMOTE|MEKANIK|FOREMAN|MECHANIC|WELD") ~ "EMPLOYED",
str_detect(x,"GENERAL|WORK|WAIT|PELAYAN|CHEF|TUKANG MASAK|CASHIER|SALESMAN|CUSTOMER SERVICE|TUKANG CUCI|TUKANG GUNTING RAMBUT|CLEANER|TUKANG SAPU") ~ "EMPLOYED",
str_detect(x,"BURUH|LABOURER|KELINDAN|PENCUCI KERETA|PENGHANTAR|RECEPTIONIS|SETIAUSAHA|CLERK|OFFICE BOY|MARKETING") ~ "EMPLOYED",
str_detect(x,"HOUSEKEEPING|HOUSE KEEPING|OFFSHORE|KERJA|ELECTRICIAN|PENYAMBUT TETAMU|HOTEL") ~ "EMPLOYED",
str_detect(x,"PEMANDU") & !str_detect(x,"TEKSI") ~ "EMPLOYED",
str_detect(x,"TUAI RUMAH|POSMEN|MAID|ORANG GAJI|GRAFIK|PROGRAMMER|WEB|SOFTWARE|WAREHOUSE|DESIGNER|AUDITOR|CONSULTANT") ~ "EMPLOYED",
str_detect(x,"KETUA|PENGETUA|PENGHULU|IMAM|SAMI") ~ "EMPLOYED",
str_detect(x,"ACCO") ~ "EMPLOYED",
str_detect(x,"AGENSI") ~ "EMPLOYED",
str_detect(x,"PENGURUS|PENYELIA|MANAGER|PENGARAH|MANDUR") ~ "EMPLOYED",
str_detect(x,"PEKERJA") & !str_detect(x,"AGEN")~ "EMPLOYED",
str_detect(x,"PEMBANTU|^ASS| ASS")  ~ "EMPLOYED",
str_detect(x,"EXC") | str_detect(x,"EXEC") | str_detect(x,"EKSE") ~ "EMPLOYED",
#str_detect(x,"SENDIRI") & !str_detect(x,"^SUR")~ "SELF-EMPLOYED",
str_detect(x,"^SURV") ~ "EMPLOYED",
str_detect(x,"BUSINESS|BISNES|USAHAWAN|PEMOTONG RUMPUT|PENGASUH") ~ "SELF-EMPLOYED",
str_detect(x,"PETANI|PENEROKA|NELAYAN|PENOREH|MENOREH|PESAWAH|PEKEBUN|PELADANG|KAMPUNG") ~ "SELF-EMPLOYED",
str_detect(x,"PLUMBER|TUKANG.*RUMAH|TUKANG KAYU|TUKANG CAT|TUKANG JAHIT|TAILOR|PEMOTONG KAYU|TUKANG URUT|TUKANG PAIP|TUKANG BESI|TUKANG WIRING|TUKANG KIMPAL|TUKANG KASUT|PENYANYI|CARPENTER|FARMER") ~ "SELF-EMPLOYED",
str_detect(x,"NIAGA") | str_detect(x,"JAJA") | str_detect(x,"JUAL") & !str_detect(x,"PHARMA") ~ "SELF-EMPLOYED",
str_detect(x,"^NA$|NIL") ~ "UNEMPLOYED"
#str_detect(x,"^SUR") | str_detect(x,"^SRT") & !str_detect(x,"^SURV") ~ "SRT",
#str_detect(x,"^SURV") ~ "UNEMPLOYED"
)
#KONTRAK|KONTREK|
y <- ifelse(str_detect(x,"WARGA"),ifelse(str_detect(x,"TUA|MAS") & !str_detect(x,"ASING"),"UNEMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"OLD AGE"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"KONT|CONT"),ifelse(str_detect(x,"CONTRACTOR|KONTRAK|KONTAKTOR|KONTREKTOR|KONTAK|KONTARKTOR|KONTARK|KONTRACT|KONTARAKTOR") & !str_detect(x,"BURU|KERJA|GURU|JURUTERA|JURUUKUR"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"WIR"),ifelse(str_detect(x,"ONLINE"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"PESARA") | str_detect(x,"PERSARA") | str_detect(x,"BERSARA") | str_detect(x,"BESARA") | str_detect(x,"PENCEN") | str_detect(x,"PENSION") | str_detect(x,"RETIRED"),"RETIREE",y)
y <- ifelse(str_detect(x,"SALE"),ifelse(str_detect(x,"ONLINE"),"SELF-EMPLOYED","EMPLOYED"),y)
y <- ifelse(str_detect(x,"KANAK|^BAYI$"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"^SUR|SRT|HOUSEWIFE") & !str_detect(x,"^SURV"),"SRT",y)
y <- ifelse(str_detect(x,"SEX WORKER"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"TEKSI")& !str_detect(x,"KERANI|PENYELIA"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"^AGEN|^AGEN$|AGENT|^AJEN|^EJEN"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"SENDIRI|BEBAS|FREELANCE"),"SELF-EMPLOYED",y)
y <- ifelse(str_detect(x,"PELAJAR|STUDENT|BELAJAR"),"STUDENT",y)
y <- ifelse(str_detect(x,"TIDAK|BEKAS|^TIADA")&!str_detect(x,"BANDUAN"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"PENGANGGUR|PENGGANGUR|MENGANGGUR|PENGANGUR|KEBUN|HOMELESS|GELANDANGAN|UNEMPLOYED"),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"BEKAS|^EX "),"UNEMPLOYED",y)
y <- ifelse(str_detect(x,"BANDUAN") & !str_detect(x,"BEKAS"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"RUMAH ORANG TUA"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"BANDUAN") & !str_detect(x,"BEKAS") & str_detect(x,"TIDAK"),"INSTITUTION",y)
y <- ifelse(str_detect(x,"TAHANAN|^TAHANAN| TAHANAN|DITAHAN|TAHAN") & !str_detect(x,"PERTAHANAN|PEGAWAI|PEMANDU|POLIS|TENTERA"),ifelse(str_detect(x,"BEKAS"),"UNEMPLOYED","INSTITUTION"),y)
#y <- ifelse(str_detect(x,"^NA$"),NA,y)
#y <- ifelse(str_detect(x,"PESARA") | str_detect(x,"BERSARA") | str_detect(x,"BESARA"),"UNEMPLOYED",y)
return(y)
}
tb_index_rc <- tb_index_rc %>% mutate("Recode Pekerjaan" = job_recode(`Clean Pekerjaan`))
job_cat <- tb_index_rc %>% filter(is.na(`Recode Pekerjaan`)) %>% count(`Clean Pekerjaan`,`Recode Pekerjaan`) %>% arrange(desc(n))
View(job_cat)
rm(list = ls())
tb_verify <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="Yus-verified")
tb_latent <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="TB-latent")
finalmatch <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="final-match")
match_verify <- inner_join(tb_verify,tb_latent,by="ID Pesakit")
View(match_verify)
count_match <- match_verify %>% count(`ID Pesakit`)
View(count_match)
View(count_match)
match_verify <- inner_join(tb_verify,tb_latent,by="Clean No KP")
View(match_verify)
tb_verify <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="Yus-verify")
tb_latent <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="TB-latent")
finalmatch <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="final-match")
combine <- rbind(tb_verify,tb_latent,finalmatch)
View(combine)
write_xlsx(combine,"input/clean_data/TBic_combine.xlsx")
combine <- combine %>% arrange(`Clean No KP`,`Tarikh Daftar Kes`,`Tarikh Pendaftaran`)
write_xlsx(combine,"input/clean_data/TBic_combine.xlsx")
tb_index_rc <- read_excel("input/clean_data/TB_index_all.xlsx")
tb_index_rc %>% filter(`ID Pesakit`=="1570284") %>% select(`ID Pesakit`,`Lokasi Tempat Tinggal Semasa`)
View(tb_index_rc)
tbic_combine <- read_excel("input/clean_data/TBic_combine.xlsx",sheet="final-V2")
tbic_combine
tbic_combine %>% collect()
dupe <- tbic_dupe[duplicated(tbic_combine[c("No KP Indeks.x")]) | duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
dupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) | duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
View(dupe)
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
dupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) & !duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",dupe)
writeData(wb,"TB-finalV2",notdupe)
notdupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]) | duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
dupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) & !duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]) | duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
tbic_combine %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) & duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]) | !duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
tbic_combine %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
notdupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]), ]
dupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]) | !duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
dupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
notdupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]), ]
notdupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
notdupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) & duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
notdupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
notdupe %>% filter(`No KP Indeks.x`==314120348) %>% select(`ID Pesakit`,Nama,`No KP Indeks.x`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
dupe <- tbic_combine[!duplicated(tbic_combine[c("No KP Indeks.x")]) | !duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[duplicated(tbic_combine[c("No KP Indeks.x")]) & duplicated( tbic_combine[c("No KP Indeks.x")],fromLast = TRUE), ]
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
View(dupe)
dupe <- dupe %>% arrange(`No KP Indeks.x`,`Tarikh Daftar Kes`,`Tarikh Pendaftaran`)
View(dupe)
dupe <- dupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
View(dupe)
View(notdupe)
str(dupe)
names(dupe)
dupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) | !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) | !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[duplicated(tbic_combine[c("Clean No KP")]) & duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
notdupe <- arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
dupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) | !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- dupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[duplicated(tbic_combine[c("Clean No KP")]) & duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
notdupe <- notdupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
View(dupe)
View(notdupe)
notdupe %>% filter(`Clean No KP`=="770303087221")
notdupe %>% filter(`Clean No KP`=="770425026259")
dupe %>% filter(`Clean No KP`=="770425026259")
dupe <- tbic_combine[duplicated(tbic_combine[c("Clean No KP")]) & duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- dupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
View(dupe)
dupe %>% filter(`Clean No KP`=="510315135701")
dupe <- tbic_combine[duplicated(tbic_combine[c("Clean No KP")]) | duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- dupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
View(dupe)
notdupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) | !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
notdupe <- notdupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
View(notdupe)
dupe %>% filter(`Clean No KP`=="510315135701")
notdupe %>% filter(`Clean No KP`=="510315135701")
notdupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) & !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
notdupe <- notdupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
notdupe %>% filter(`Clean No KP`=="510315135701")
dupe %>% filter(`Clean No KP`=="510315135701")
notdupe %>% filter(`Clean No KP`=="510315135701")
dupe <- tbic_combine[duplicated(tbic_combine[c("Clean No KP")]) | duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
dupe <- dupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
wb <- createWorkbook("input/clean_data/TBic_combineV2.xlsx")
addWorksheet(wb, "TB-latentV2")
writeData(wb,"TB-latentV2",dupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
notdupe <- tbic_combine[!duplicated(tbic_combine[c("Clean No KP")]) & !duplicated( tbic_combine[c("Clean No KP")],fromLast = TRUE), ]
notdupe <- notdupe %>% arrange(`Clean No KP`,`Tarikh Pendaftaran`,`Tarikh Daftar Kes`)
addWorksheet(wb, "TB-finalV2")
writeData(wb,"TB-finalV2",notdupe)
saveWorkbook(wb, file = "input/clean_data/TBic_combineV2.xlsx", overwrite = TRUE)
library(tidyverse)
library(readxl)
library(janitor)
library(skimr)
library(lubridate)
library(writexl)
tbi_2013 <- read_excel("input/raw_data/TBIS101A_2013.xlsx")
tbi_2014 <- read_excel("input/raw_data/TBIS101A_2014.xlsx",sheet = "TBIS 101A")
tbi_2015 <- read_excel("input/raw_data/TBIS101A_2015.xlsx",sheet = "TBIS 101A")
tbi_2016 <- read_excel("input/raw_data/TBIS101A_2016.xlsx")
tbi_2017 <- read_excel("input/raw_data/TBIS101A_2017.xlsx")
tb_index <- rbind(tbi_2013,tbi_2014,tbi_2015,tbi_2016,tbi_2017)
names(tb_index)
tb_index %>% filter(Negeri=="Selangor")
tb_index %>% filter(Negeri=="Selangor") %>% count()
tb_index %>% filter(Negeri=="SELANGOR") %>% count()
tb_index %>% count(Negeri)
tb_index-selangor <- tb_index %>% filter(Negeri=="SELANGOR")
tbi_selangor <- tb_index %>% filter(Negeri=="SELANGOR")
write_xlsx(tbi_selangor,"input/clean_data/TBi_Selangor.xlsx")
tbi_selangor %>% count(`Punca Notifikasi`)
tbi_selangor %>% count(`Nama Pusat Rawatan Yang Memulakan Rawatan`)
location <- tbi_selangor %>% count(`Nama Pusat Rawatan Yang Memulakan Rawatan`)
View(location)
job <- tbi_selangor %>% count(`Pekerjaan Utama`)
View(job)
setwd("~/Dropbox/Workspace-DBX/TB-IKU/input")
setwd("~/Dropbox/Workspace-DBX/TB-IKU")
library(xlsx)
tb_1317 <- read_excel("input/clean_data/tb data entry_1.xlsx")
library(readxl)
tb_1317 <- read_excel("input/clean_data/tb data entry_1.xlsx")
names(tb_1317)
str(tb_1317)
View(tb_1317)
tb_1317 <- read_csv("input/clean_data/use2_tb1317.csv")
tb_1317 <- read_csv2("input/clean_data/use2_tb1317.csv")
library(readxl)
tb_1317 <- read_csv2("input/clean_data/use2_tb1317.csv")
library(tidyverse)
tb_1317 <- read_csv2("input/clean_data/use2_tb1317.csv")
View(tb_1317)
View(tb_1317)
tb_1317 <- read_csv2("input/clean_data/use2_tb1317.csv",sep=",")
tb_1317 <- read_csv2("input/clean_data/use2_tb1317.csv")
View(tb_1317)
tb_1317 <- read_excel("input/clean_data/use2_tb1317.xlsx")
View(tb_1317)
names(tb_1317)
colnames(tb_1317)[colnames(tb_1317)=="...1"] <- "bil"
library(mice)
tb_1317.imp <- mice(tb_1317,seed=12345)
count(tb_1317$bilangan_tanggungan)
levels(tb_1317$bilangan_tanggungan)
tb_1317$bilangan_tanggungan
class(tb_1317$bilangan_tanggungan)
names(tb_1317)
View(tb_1317)
colnames(tb_1317)[colnames(tb_1317)=="bilangan_tanggungan"] <- "bil_tanggungan"
tb_1317.imp <- mice(tb_1317,seed=12345)
tb_1317 %>% filter(is.na(bil_tanggungan))
tb_1317 %>% filter(is.na(status_pendapatan))
tb_1317 %>% filter(is.na(tarikh_lahir))
tb_1317 %>% filter(is.na(tarikh_lahir)) %>% count()
tb_1317 %>% filter(tarikh_lahir=="NA") %>% count()
tb_1317.imp <- mice(tb_1317,seed=12345)
test <- tb_1317 %>% select(tarikh_lahir,umur_hari)
test.imp <- mice(test,seed=12345)
update(mice)
install.packages("mice")
test.imp <- mice(test,seed=12345)
library(mice)
test.imp <- mice(test,seed=12345)
tb_1317.imp <- mice(tb_1317,seed=12345)
tb_1317v2 <- tb_1317 %>% mutate(`Pendidikan` = ifelse(status_pendidikan_pesakit == "Tingkatan 1/2/3","Tingkatan 123",status_pendidikan_pesakit))
library(xlsx)
library(readxl)
library(tidyverse)
tb_1317v2 <- tb_1317 %>% mutate(`Pendidikan` = ifelse(status_pendidikan_pesakit == "Tingkatan 1/2/3","Tingkatan 123",status_pendidikan_pesakit))
View(tb_1317v2)
tb_1317v2 <- tb_1317v2 %>% select(-c(status_pendidikan_pesakit))
tb_1317v2.imp <- mice(tb_1317v2,seed=12345)
str(tb_1317v2)
tb_1317 %>% filter(is.na(umur_tahun))
tb_1317 %>% filter(umur_tahun=="NA")
tb_1317v2 <- tb_1317 %>% select(status_pendidikan_pesakit,bil_tanggungan)
tb_1317v2.imp <- mice(tb_1317v2,seed=12345)
View(tb_1317v2)
tb_1317v2[tb_1317v2 == "NA" ] <- NA
View(tb_1317v2)
tb_1317v2.imp <- mice(tb_1317v2,seed=12345)
tb_1317.imp <- mice(tb_1317,seed=12345)
library(rmarkdown)
options(repos=c(CRAN="https://cran.rstudio.com"))
setwd("C:/Users/Ahmad Adizul/Dropbox/2019-Documents/Courses/PHC410/PHC410-slides/Slides")
getOption("repos")
setwd("C:/Users/Ahmad Adizul/Dropbox/2019-Documents/Courses/PHC410/PHC410-slides/Slides")
options(repos=c(CRAN="https://cran.rstudio.com"))
devtools::install_github("rstudio/rmarkdown")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("rstudio/rmarkdown")
remove.packages("rmarkdown", lib="~/R/win-library/3.6")
devtools::install_github("rstudio/rmarkdown")
install.packages("rmarkdown")
getOption("repos")
devtools::install_url("http://cran.r-project.org/src/contrib/rmarkdown0.5.1.tar.gz")
install.packages("Rtools")
setwd("C:/Users/Ahmad Adizul/Dropbox/Workspace-DBX/TB-IKU")
install.packages("kableExtra")
tinytex::install_tinytex()
setwd("C:/Users/Ahmad Adizul/Dropbox/Workspace-DBX/TB-IKU")
setwd("C:/Users/Ahmad Adizul/Dropbox/Workspace-DBX/TB-IKU")
library(tidyverse)
library(readxl)
library(janitor)
library(skimr)
library(lubridate)
library(writexl)
data <- read_excel("input/clean_data/TB_index.xlsx")
tb_verify <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="Yus-verify")
tb_latent <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="TB-latent")
finalmatch <- read_excel("input/clean_data/TBic_complete.xlsx",sheet="final-match")
library(skimr)
skim(tb_latent)
con <- file("test.log")
sink(con, append=TRUE)
cat(readLines("test.log"), sep="\n")
skim(tb_latent)
cat(readLines("test.log"), sep="\n")
skim(tb_latent)
cat(readLines("test.log"), sep="\n")
sink(con, append=TRUE)
cat(readLines("test.log"), sep="\n")
cat(readLines("test.log"), sep="\n")
con <- file("test2.log")
sink(con, append=TRUE)
skim(tb_latent)
skim(tb_verify)
closeAllConnections()
con <- file("test.log")
skim(tb_verify)
sink(con, append=TRUE)
skim(tb_verify)
closeAllConnections()
skim(tb_verify)
setwd("~/Dropbox/2019-Documents/Courses/PHC410/PHC410-slides/Slides")
knitr::opts_chunk$set(echo = FALSE)
library(png)
library(kableExtra)
library(ggplot2)
library(grid)
library(gridExtra)
library(RefManageR)
knitr::write_bib(x = "rmarkdown", file = "bib.bib")
x <- c(0,1,2,3,3,5,5,5,6,7,7,10)
y <- c(96,85,82,74,95,68,76,84,58,65,75,50)
df1 <- data.frame(x1=x, x2=y)
names(df1)=c("Hours (x)","Test score (y)")
df1 <- df1 %>%
rownames_to_column %>%
gather(var, value, -rowname) %>%
spread(rowname, value)
rownames(Df2)
rownames(df2)
colnames(df2)
